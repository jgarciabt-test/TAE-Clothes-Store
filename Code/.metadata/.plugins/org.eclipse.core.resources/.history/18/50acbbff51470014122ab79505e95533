package com.tae.store.helpers;

import org.json.JSONArray;

import android.app.ProgressDialog;
import android.content.Context;
import android.util.Log;

import com.android.volley.Response;
import com.android.volley.Response.Listener;
import com.android.volley.VolleyError;
import com.android.volley.VolleyLog;
import com.android.volley.toolbox.JsonArrayRequest;
import com.google.android.gms.cast.Cast.ApplicationConnectionResult;
import com.tae.store.R;
import com.tae.store.app.AppController;

//Implements Singleton
public class NetworkRequest {

	private static NetworkRequest instance = null;
	private ProgressDialog pDialog;
	private Context context;
	private JSONArray networkResponse;

	protected NetworkRequest(Context context) {
		this.context = context;
		pDialog = new ProgressDialog(context);
		pDialog.setMessage(context.getResources().getString(R.string.loading));
	}

	public static NetworkRequest getInstance(Context context) {
		if (instance == null) {
			instance = new NetworkRequest(context);
		}
		return instance;
	}

	public JSONArray makeRequest(String url) {

		pDialog.show();
		networkResponse = new JSONArray();

		String tag_json_arry = "json_array_req";
		 
//		String url2 = "http://192.168.1.4/TAE_STORE/get_categories.php?main_category=men";
//		             
//		         
//		JsonArrayRequest req = new JsonArrayRequest(url2,
//		                new Response.Listener<JSONArray>() {
//		                    @Override
//		                    public void onResponse(JSONArray response) {
//		                        Log.d("WEB", response.toString());        
//		                        pDialog.hide();             
//		                    }
//		                }, new Response.ErrorListener() {
//		                    @Override
//		                    public void onErrorResponse(VolleyError error) {
//		                        VolleyLog.d("WEB", "Error: " + error.getMessage());
//		                        pDialog.hide();
//		                    }
//		                });
//		 
//		// Adding request to request queue
//		AppController.getInstance().addToRequestQueue(req, tag_json_arry);
		
		
		JsonArrayRequest request = new JsonArrayRequest(url,
				new Listener<JSONArray>() {
					public void onResponse(JSONArray response) {
						pDialog.hide();
						Log.v("WEB", "OnResponse");
						networkResponse = response;
					}
				}, new Response.ErrorListener() {
					@Override
					public void onErrorResponse(VolleyError error) {
						pDialog.hide();
						VolleyLog.d("VOLLEY_ERROR", "Error: " + error.getMessage());
						Log.v("WEB", "OnErrorResponse");
					}
				});

		AppController.getInstance().addToRequestQueue(request);
		return networkResponse;
	}

}
