package com.tae.store.fragments;

import org.brickred.socialauth.Profile;
import org.brickred.socialauth.android.DialogListener;
import org.brickred.socialauth.android.SocialAuthAdapter;
import org.brickred.socialauth.android.SocialAuthAdapter.Provider;
import org.brickred.socialauth.android.SocialAuthError;
import org.brickred.socialauth.android.SocialAuthListener;

import android.graphics.LightingColorFilter;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.EditText;
import android.widget.RadioButton;
import android.widget.RadioGroup;
import android.widget.ScrollView;
import android.widget.Spinner;
import android.widget.Toast;

import com.actionbarsherlock.app.SherlockFragment;
import com.tae.store.R;

public class LogInFragment extends SherlockFragment {

	SocialAuthAdapter adapter;

	private EditText etName;
	private EditText etLastName;
	private EditText etEmail;
	private RadioGroup rgGender;
	private Spinner spCountry;
	private EditText etAddress;
	private EditText etPostCode;
	private EditText etCity;
	private CheckBox terms;
	private Button btnSubmit;
	private Button btnPicture;

	@Override
	public View onCreateView(LayoutInflater inflater, ViewGroup container,
			Bundle savedInstanceState) {

		ViewGroup rootView = (ViewGroup) inflater.inflate(
				R.layout.fragment_login, container, false);

		Button btnFacebook = (Button) rootView
				.findViewById(R.id.connectWithFbButton);

		btnFacebook.setOnClickListener(new OnClickListener() {

			@Override
			public void onClick(View v) {
				adapter = new SocialAuthAdapter(new ResponseListener());
				adapter.authorize(getActivity(), Provider.FACEBOOK);

			}
		});

		// Button btnFacebookLogout = (Button) rootView
		// .findViewById(R.id.disconnectWithFbButton);
		//
		// btnFacebookLogout.setOnClickListener(new OnClickListener() {
		//
		// @Override
		// public void onClick(View v) {
		// adapter.signOut(getActivity().getApplicationContext(),
		// Provider.FACEBOOK.toString());
		//
		// }
		// });

		etName = (EditText) rootView.findViewById(R.id.registration_name);
		etLastName = (EditText) rootView
				.findViewById(R.id.registration_last_name);
		rgGender = (RadioGroup) rootView.findViewById(R.id.registration_gender);
		spCountry = (Spinner) rootView.findViewById(R.id.registration_country);
		etAddress = (EditText) rootView.findViewById(R.id.registration_address);
		etPostCode = (EditText) rootView.findViewById(R.id.registration_pc);
		etEmail = (EditText) rootView.findViewById(R.id.registration_email);
		etCity = (EditText) rootView.findViewById(R.id.registration_city);
		terms = (CheckBox) rootView.findViewById(R.id.registration_terms);
		btnSubmit = (Button) rootView.findViewById(R.id.registration_submit);

		btnSubmit.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				checkFields();
			}
		});

		ScrollView scrollView = (ScrollView) rootView.findViewById(R.id.scrool);
		scrollView.getViewTreeObserver().addOnScrollChangedListener(new OnScrollChangedListener() {

		    @Override
		    public void onScrollChanged() {

		        int scrollX = rootScrollView.getScrollX(); //for horizontalScrollView
		        int scrollY = rootScrollView.getScrollY(); //for verticalScrollView
		        //DO SOMETHING WITH THE SCROLL COORDINATES

		    }
		});
		
		
		return rootView;
	}

	private boolean checkFields() {
		boolean complete = true;
		String gen = "";

		// Name
		if (etName.getText().toString().matches("")) {
			complete = false;
			etName.setError("Required");
		}
		// Last Name
		if (etLastName.getText().toString().matches("")) {
			complete = false;
			etLastName.setError("Required");
		}
		// Age
		if (etEmail.getText().toString().matches("")) {
			complete = false;
			etEmail.setError("Required");
		}

		// Radio Group
		int index = rgGender.getCheckedRadioButtonId();
		if (index == -1) {
			complete = false;
		} else {
			View rdBtn = rgGender.findViewById(index);
			int id = rgGender.indexOfChild(rdBtn);
			RadioButton btn = (RadioButton) rgGender.getChildAt(id);
			gen = btn.getText().toString();
		}

		// Address
		if (etAddress.getText().toString().matches("")) {
			complete = false;
			etAddress.setError("Required");
		}

		// Post Code
		if (etPostCode.getText().toString().matches("")) {
			complete = false;
			etPostCode.setError("Required");
		}
		// City
		if (etCity.getText().toString().matches("")) {
			complete = false;
			etCity.setError("Required");
		}

		if (!terms.isChecked()) {
			complete = false;
			Toast.makeText(getActivity(),
					"You need to accept the Terms and...", Toast.LENGTH_LONG)
					.show();
		}

		return complete;
	}

	private final class ResponseListener implements DialogListener {
		public void onComplete(Bundle values) {
			adapter.getUserProfileAsync(new ProfileDataListener());

		}

		@Override
		public void onBack() {
			// TODO Auto-generated method stub
			Toast.makeText(getActivity().getApplicationContext(),
					"facebook back", Toast.LENGTH_SHORT).show();

		}

		@Override
		public void onCancel() {
			// TODO Auto-generated method stub
			Toast.makeText(getActivity().getApplicationContext(),
					"facebook cancel", Toast.LENGTH_SHORT).show();

		}

		@Override
		public void onError(SocialAuthError arg0) {
			// TODO Auto-generated method stub
			Toast.makeText(getActivity().getApplicationContext(),
					"facebook error", Toast.LENGTH_SHORT).show();

		}

	}

	private final class ProfileDataListener implements
			SocialAuthListener<Profile> {

		@Override
		public void onError(SocialAuthError arg0) {
			// TODO Auto-generated method stub

		}

		@Override
		public void onExecute(String arg0, Profile arg1) {
			Toast.makeText(getActivity().getApplicationContext(),
					" Loged as" + arg1.getFullName(), Toast.LENGTH_SHORT)
					.show();

		}
	}

}
